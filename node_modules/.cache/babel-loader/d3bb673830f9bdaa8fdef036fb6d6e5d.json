{"ast":null,"code":"var _jsxFileName = \"/Users/majy/work/bici/code/editor-demo/src/features/editor/EditorEdges.tsx\";\n\n/**\n * @file 通用边组件\n * @author perkinJ\n */\nimport * as React from \"react\";\nimport * as _ from \"lodash\";\nimport Edge from \"./components/Edge\";\nimport { quadratic, calcLinkPosition } from \"./utils/calc\";\nimport { ACTIVE, LINK, UNLINK } from \"./defines\";\nimport \"./EditorEdges.scss\";\n\nclass EditorEdgesProps {\n  constructor() {\n    this.id = void 0;\n    this.links = void 0;\n    this.nodes = void 0;\n    this.selectedLinks = void 0;\n    this.onSelectLink = void 0;\n    this.onContextMenu = void 0;\n    this.isDraggingLink = void 0;\n    this.dragLink = void 0;\n    this.interactive = void 0;\n  }\n\n}\n\nexport function EditorEdges(props) {\n  const {\n    links,\n    nodes,\n    selectedLinks,\n    onSelectLink,\n    onContextMenu,\n    isDraggingLink,\n    dragLink,\n    interactive = true\n  } = props;\n  const edgesPath = links.map(link => {\n    const {\n      source,\n      target,\n      id,\n      sourcePos,\n      targetPos\n    } = link;\n\n    const uNode = _.find(nodes, vertex => {\n      return vertex.id === source;\n    });\n\n    const vNode = _.find(nodes, vertex => {\n      return vertex.id === target;\n    });\n\n    const {\n      x: sourceX,\n      y: sourceY\n    } = calcLinkPosition(uNode, sourcePos);\n    const {\n      x: targetX,\n      y: targetY\n    } = calcLinkPosition(vNode, targetPos); // 自定义路径\n\n    const pathData = quadratic({\n      x: sourceX,\n      y: sourceY\n    }, {\n      x: targetX,\n      y: targetY\n    }); // 连线的中点\n    // const centerX = (uNode.x + NODE_WIDTH + vNode.x) / 2;\n    // const centerY = (uNode.y + NODE_HEIGHT + vNode.y) / 2;\n\n    const isActive = selectedLinks ? selectedLinks.includes(id) : false;\n    const fill = isActive ? ACTIVE : LINK;\n    const style = {\n      fill,\n      stroke: fill,\n      strokeWidth: 2\n    };\n    return /*#__PURE__*/React.createElement(Edge, {\n      key: id,\n      id: id,\n      path: pathData,\n      lineAppendWidth: 15,\n      style: style,\n      onContextMenu: interactive ? onContextMenu.bind(null, id) : null,\n      onClick: interactive ? onSelectLink.bind(null, id) : null,\n      endArrow: /*#__PURE__*/React.createElement(\"marker\", {\n        id: `${id}-endArrow`,\n        markerWidth: \"10\",\n        markerHeight: \"10\",\n        refX: \"0\",\n        refY: \"2\",\n        orient: \"auto\",\n        markerUnits: \"strokeWidth\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"path\", {\n        d: \"M0,0 L0,4 L4,2 z\",\n        fill: fill,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 13\n        }\n      })) // object={\n      //   (type || _.isBoolean(sendTo)) &&\n      //   !iconDisabled && (\n      //     <foreignObject\n      //       width={LINKICON_WIDTH}\n      //       height=\"60\"\n      //       x={centerX - LINKICON_WIDTH / 2}\n      //       y={centerY - LINKICON_HEIGHT / 2}\n      //     >\n      //       <div className=\"link-icon\">\n      //       </div>\n      //     </foreignObject>\n      //   )\n      // }\n      ,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 7\n      }\n    });\n  });\n\n  const renderDraggingLink = () => {\n    if (isDraggingLink) {\n      const {\n        x,\n        y,\n        originX,\n        originY\n      } = dragLink;\n      const pathData = quadratic({\n        x: originX,\n        y: originY\n      }, {\n        x,\n        y\n      });\n      return /*#__PURE__*/React.createElement(Edge, {\n        path: pathData,\n        endArrow: /*#__PURE__*/React.createElement(\"marker\", {\n          id: `${UNLINK}-endArrow`,\n          markerWidth: \"10\",\n          markerHeight: \"10\",\n          refX: \"0\",\n          refY: \"2\",\n          orient: \"auto\",\n          markerUnits: \"strokeWidth\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(\"path\", {\n          d: \"M0,0 L0,4 L4,2 z\",\n          fill: UNLINK,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 15\n          }\n        })),\n        style: {\n          fill: UNLINK,\n          stroke: UNLINK,\n          strokeWidth: 2\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 9\n        }\n      });\n    }\n\n    return null;\n  }; // 更新画布容器的高度\n\n\n  const width = document.body.scrollWidth;\n  const height = document.body.scrollHeight;\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    className: \"editor-view-svg\",\n    width: \"552px\",\n    height: \"632px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 5\n    }\n  }, links && edgesPath, interactive && renderDraggingLink());\n}","map":{"version":3,"sources":["/Users/majy/work/bici/code/editor-demo/src/features/editor/EditorEdges.tsx"],"names":["React","_","Edge","quadratic","calcLinkPosition","ACTIVE","LINK","UNLINK","EditorEdgesProps","id","links","nodes","selectedLinks","onSelectLink","onContextMenu","isDraggingLink","dragLink","interactive","EditorEdges","props","edgesPath","map","link","source","target","sourcePos","targetPos","uNode","find","vertex","vNode","x","sourceX","y","sourceY","targetX","targetY","pathData","isActive","includes","fill","style","stroke","strokeWidth","bind","renderDraggingLink","originX","originY","width","document","body","scrollWidth","height","scrollHeight"],"mappings":";;AAAA;;;;AAKA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAO,KAAKC,CAAZ,MAAmB,QAAnB;AACA,OAAOC,IAAP,MAAiB,mBAAjB;AACA,SAASC,SAAT,EAAoBC,gBAApB,QAA4C,cAA5C;AACA,SAAqBC,MAArB,EAA6BC,IAA7B,EAAmCC,MAAnC,QAAiD,WAAjD;AACA,OAAO,oBAAP;;AAEA,MAAMC,gBAAN,CAAuB;AAAA;AAAA,SAErBC,EAFqB;AAAA,SAKrBC,KALqB;AAAA,SAQrBC,KARqB;AAAA,SAWrBC,aAXqB;AAAA,SAcrBC,YAdqB;AAAA,SAoBrBC,aApBqB;AAAA,SA0BrBC,cA1BqB;AAAA,SA6BrBC,QA7BqB;AAAA,SAyCrBC,WAzCqB;AAAA;;AAAA;;AA4CvB,OAAO,SAASC,WAAT,CAAqBC,KAArB,EAA8C;AACnD,QAAM;AACJT,IAAAA,KADI;AAEJC,IAAAA,KAFI;AAGJC,IAAAA,aAHI;AAIJC,IAAAA,YAJI;AAKJC,IAAAA,aALI;AAMJC,IAAAA,cANI;AAOJC,IAAAA,QAPI;AAQJC,IAAAA,WAAW,GAAG;AARV,MASFE,KATJ;AAUA,QAAMC,SAAS,GAAGV,KAAK,CAACW,GAAN,CAAUC,IAAI,IAAI;AAClC,UAAM;AAAEC,MAAAA,MAAF;AAAUC,MAAAA,MAAV;AAAkBf,MAAAA,EAAlB;AAAsBgB,MAAAA,SAAtB;AAAiCC,MAAAA;AAAjC,QAA+CJ,IAArD;;AACA,UAAMK,KAAK,GAAG1B,CAAC,CAAC2B,IAAF,CAAOjB,KAAP,EAAckB,MAAM,IAAI;AACpC,aAAOA,MAAM,CAACpB,EAAP,KAAcc,MAArB;AACD,KAFa,CAAd;;AAGA,UAAMO,KAAK,GAAG7B,CAAC,CAAC2B,IAAF,CAAOjB,KAAP,EAAckB,MAAM,IAAI;AACpC,aAAOA,MAAM,CAACpB,EAAP,KAAce,MAArB;AACD,KAFa,CAAd;;AAGA,UAAM;AAAEO,MAAAA,CAAC,EAAEC,OAAL;AAAcC,MAAAA,CAAC,EAAEC;AAAjB,QAA6B9B,gBAAgB,CAACuB,KAAD,EAAQF,SAAR,CAAnD;AACA,UAAM;AAAEM,MAAAA,CAAC,EAAEI,OAAL;AAAcF,MAAAA,CAAC,EAAEG;AAAjB,QAA6BhC,gBAAgB,CAAC0B,KAAD,EAAQJ,SAAR,CAAnD,CATkC,CAWlC;;AACA,UAAMW,QAAQ,GAAGlC,SAAS,CACxB;AACE4B,MAAAA,CAAC,EAAEC,OADL;AAEEC,MAAAA,CAAC,EAAEC;AAFL,KADwB,EAKxB;AACEH,MAAAA,CAAC,EAAEI,OADL;AAEEF,MAAAA,CAAC,EAAEG;AAFL,KALwB,CAA1B,CAZkC,CAuBlC;AACA;AACA;;AAEA,UAAME,QAAQ,GAAG1B,aAAa,GAAGA,aAAa,CAAC2B,QAAd,CAAuB9B,EAAvB,CAAH,GAAgC,KAA9D;AACA,UAAM+B,IAAI,GAAGF,QAAQ,GAAGjC,MAAH,GAAYC,IAAjC;AAEA,UAAMmC,KAAK,GAAG;AACZD,MAAAA,IADY;AAEZE,MAAAA,MAAM,EAAEF,IAFI;AAGZG,MAAAA,WAAW,EAAE;AAHD,KAAd;AAMA,wBACE,oBAAC,IAAD;AACE,MAAA,GAAG,EAAElC,EADP;AAEE,MAAA,EAAE,EAAEA,EAFN;AAGE,MAAA,IAAI,EAAE4B,QAHR;AAIE,MAAA,eAAe,EAAE,EAJnB;AAKE,MAAA,KAAK,EAAEI,KALT;AAME,MAAA,aAAa,EAAExB,WAAW,GAAGH,aAAa,CAAC8B,IAAd,CAAmB,IAAnB,EAAyBnC,EAAzB,CAAH,GAAkC,IAN9D;AAOE,MAAA,OAAO,EAAEQ,WAAW,GAAGJ,YAAY,CAAC+B,IAAb,CAAkB,IAAlB,EAAwBnC,EAAxB,CAAH,GAAiC,IAPvD;AAQE,MAAA,QAAQ,eACN;AACE,QAAA,EAAE,EAAG,GAAEA,EAAG,WADZ;AAEE,QAAA,WAAW,EAAC,IAFd;AAGE,QAAA,YAAY,EAAC,IAHf;AAIE,QAAA,IAAI,EAAC,GAJP;AAKE,QAAA,IAAI,EAAC,GALP;AAME,QAAA,MAAM,EAAC,MANT;AAOE,QAAA,WAAW,EAAC,aAPd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBASE;AAAM,QAAA,CAAC,EAAC,kBAAR;AAA2B,QAAA,IAAI,EAAE+B,IAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QATF,CATJ,CAqBE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAnCF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF;AAuCD,GA3EiB,CAAlB;;AA6EA,QAAMK,kBAAkB,GAAG,MAAM;AAC/B,QAAI9B,cAAJ,EAAoB;AAClB,YAAM;AAAEgB,QAAAA,CAAF;AAAKE,QAAAA,CAAL;AAAQa,QAAAA,OAAR;AAAiBC,QAAAA;AAAjB,UAA6B/B,QAAnC;AACA,YAAMqB,QAAQ,GAAGlC,SAAS,CACxB;AACE4B,QAAAA,CAAC,EAAEe,OADL;AAEEb,QAAAA,CAAC,EAAEc;AAFL,OADwB,EAKxB;AACEhB,QAAAA,CADF;AAEEE,QAAAA;AAFF,OALwB,CAA1B;AAWA,0BACE,oBAAC,IAAD;AACE,QAAA,IAAI,EAAEI,QADR;AAEE,QAAA,QAAQ,eACN;AACE,UAAA,EAAE,EAAG,GAAE9B,MAAO,WADhB;AAEE,UAAA,WAAW,EAAC,IAFd;AAGE,UAAA,YAAY,EAAC,IAHf;AAIE,UAAA,IAAI,EAAC,GAJP;AAKE,UAAA,IAAI,EAAC,GALP;AAME,UAAA,MAAM,EAAC,MANT;AAOE,UAAA,WAAW,EAAC,aAPd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBASE;AAAM,UAAA,CAAC,EAAC,kBAAR;AAA2B,UAAA,IAAI,EAAEA,MAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UATF,CAHJ;AAeE,QAAA,KAAK,EAAE;AACLiC,UAAAA,IAAI,EAAEjC,MADD;AAELmC,UAAAA,MAAM,EAAEnC,MAFH;AAGLoC,UAAAA,WAAW,EAAE;AAHR,SAfT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAuBD;;AAED,WAAO,IAAP;AACD,GAxCD,CAxFmD,CAkInD;;;AACA,QAAMK,KAAK,GAAGC,QAAQ,CAACC,IAAT,CAAcC,WAA5B;AACA,QAAMC,MAAM,GAAGH,QAAQ,CAACC,IAAT,CAAcG,YAA7B;AAEA,sBACE;AAAK,IAAA,SAAS,EAAC,iBAAf;AAAiC,IAAA,KAAK,EAAC,OAAvC;AAA+C,IAAA,MAAM,EAAC,OAAtD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACG3C,KAAK,IAAIU,SADZ,EAEGH,WAAW,IAAI4B,kBAAkB,EAFpC,CADF;AAMD","sourcesContent":["/**\n * @file 通用边组件\n * @author perkinJ\n */\n\nimport * as React from \"react\";\nimport * as _ from \"lodash\";\nimport Edge from \"./components/Edge\";\nimport { quadratic, calcLinkPosition } from \"./utils/calc\";\nimport { Node, Link, ACTIVE, LINK, UNLINK } from \"./defines\";\nimport \"./EditorEdges.scss\";\n\nclass EditorEdgesProps {\n  /** 唯一id */\n  id?: string;\n\n  /** 边 */\n  links: Link[];\n\n  /** 节点 */\n  nodes: Node[];\n\n  /** 被点击的连线 */\n  selectedLinks?: string[];\n\n  /** 选择某条线 */\n  onSelectLink?: (\n    key: string,\n    event: React.MouseEvent<SVGPathElement, MouseEvent>\n  ) => void;\n\n  /** 右键某条线 */\n  onContextMenu?: (\n    key: string,\n    event: React.MouseEvent<SVGPathElement, MouseEvent>\n  ) => void;\n\n  /** 是否连线 */\n  isDraggingLink?: boolean;\n\n  /** 拖拽连线属性 */\n  dragLink?: {\n    /** 源起节点id */\n    originId: string;\n    /** 源起节点 */\n    originX: number;\n    originY: number;\n    /** 鼠标移动节点 */\n    x: number;\n    y: number;\n  };\n\n  /** 是否可交互 */\n  interactive?: boolean;\n}\n\nexport function EditorEdges(props: EditorEdgesProps) {\n  const {\n    links,\n    nodes,\n    selectedLinks,\n    onSelectLink,\n    onContextMenu,\n    isDraggingLink,\n    dragLink,\n    interactive = true\n  } = props;\n  const edgesPath = links.map(link => {\n    const { source, target, id, sourcePos, targetPos } = link;\n    const uNode = _.find(nodes, vertex => {\n      return vertex.id === source;\n    });\n    const vNode = _.find(nodes, vertex => {\n      return vertex.id === target;\n    });\n    const { x: sourceX, y: sourceY } = calcLinkPosition(uNode, sourcePos);\n    const { x: targetX, y: targetY } = calcLinkPosition(vNode, targetPos);\n\n    // 自定义路径\n    const pathData = quadratic(\n      {\n        x: sourceX,\n        y: sourceY\n      },\n      {\n        x: targetX,\n        y: targetY\n      }\n    );\n\n    // 连线的中点\n    // const centerX = (uNode.x + NODE_WIDTH + vNode.x) / 2;\n    // const centerY = (uNode.y + NODE_HEIGHT + vNode.y) / 2;\n\n    const isActive = selectedLinks ? selectedLinks.includes(id) : false;\n    const fill = isActive ? ACTIVE : LINK;\n\n    const style = {\n      fill,\n      stroke: fill,\n      strokeWidth: 2\n    };\n\n    return (\n      <Edge\n        key={id}\n        id={id}\n        path={pathData}\n        lineAppendWidth={15}\n        style={style}\n        onContextMenu={interactive ? onContextMenu.bind(null, id) : null}\n        onClick={interactive ? onSelectLink.bind(null, id) : null}\n        endArrow={\n          <marker\n            id={`${id}-endArrow`}\n            markerWidth=\"10\"\n            markerHeight=\"10\"\n            refX=\"0\"\n            refY=\"2\"\n            orient=\"auto\"\n            markerUnits=\"strokeWidth\"\n          >\n            <path d=\"M0,0 L0,4 L4,2 z\" fill={fill} />\n          </marker>\n        }\n        // object={\n        //   (type || _.isBoolean(sendTo)) &&\n        //   !iconDisabled && (\n        //     <foreignObject\n        //       width={LINKICON_WIDTH}\n        //       height=\"60\"\n        //       x={centerX - LINKICON_WIDTH / 2}\n        //       y={centerY - LINKICON_HEIGHT / 2}\n        //     >\n        //       <div className=\"link-icon\">\n\n        //       </div>\n        //     </foreignObject>\n        //   )\n        // }\n      />\n    );\n  });\n\n  const renderDraggingLink = () => {\n    if (isDraggingLink) {\n      const { x, y, originX, originY } = dragLink;\n      const pathData = quadratic(\n        {\n          x: originX,\n          y: originY\n        },\n        {\n          x,\n          y\n        }\n      );\n\n      return (\n        <Edge\n          path={pathData}\n          endArrow={\n            <marker\n              id={`${UNLINK}-endArrow`}\n              markerWidth=\"10\"\n              markerHeight=\"10\"\n              refX=\"0\"\n              refY=\"2\"\n              orient=\"auto\"\n              markerUnits=\"strokeWidth\"\n            >\n              <path d=\"M0,0 L0,4 L4,2 z\" fill={UNLINK} />\n            </marker>\n          }\n          style={{\n            fill: UNLINK,\n            stroke: UNLINK,\n            strokeWidth: 2\n          }}\n        />\n      );\n    }\n\n    return null;\n  };\n\n  // 更新画布容器的高度\n  const width = document.body.scrollWidth;\n  const height = document.body.scrollHeight;\n\n  return (\n    <svg className=\"editor-view-svg\" width=\"552px\" height=\"632px\">\n      {links && edgesPath}\n      {interactive && renderDraggingLink()}\n    </svg>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}